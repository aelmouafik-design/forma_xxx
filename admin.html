<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Gestion des Formations</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Quill CSS & JS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        },
                        neutral: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // -- ICONS (Raw SVGs for standalone simplicity) --
        const Icons = {
            Plus: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
            Trash: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            Edit: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Copy: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>,
            Check: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            ChevronRight: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>,
            ChevronLeft: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>,
            Home: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
            MapPin: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            Phone: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>,
            Users: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>,
            Eye: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
        };

        // -- MOCK DATA --
        const INITIAL_TRAINERS = [
            { id: 101, firstName: "Alice", lastName: "Dupont", email: "alice@example.com", phone: "0601020304", city: "Paris", company: "AI Solutions", domains: ["Informatique", "Data"] },
            { id: 102, firstName: "Bob", lastName: "Martin", email: "bob@example.com", phone: "0699887766", city: "Lyon", company: "SecurIT", domains: ["Informatique", "Management"] },
            { id: 103, firstName: "Charlie", lastName: "Zen", email: "charlie@example.com", phone: "0755443322", city: "Bordeaux", company: "Soft Skills Agency", domains: ["Soft Skills"] }
        ];

        const INITIAL_COURSES = [
            {
                id: 1,
                title: "INITIATION IA",
                category: "Informatique",
                duration: "2 jours",
                price: 1500,
                status: "Publié",
                image: "https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&w=800&q=80",
                mainTrainer: "101",
                description: "<p><strong>Plongez dans le monde de l'IA !</strong> Cette formation vous donnera les clés pour comprendre et utiliser les outils d'IA générative actuels.</p>",
                tags: "IA, Débutant, Tendance",
                prerequis: ["Aucun prérequis technique", "Avoir un ordinateur portable"],
                objectifs: ["Comprendre le fonctionnement des LLM", "Maîtriser le prompt engineering de base", "Identifier les cas d'usage en entreprise"],
                programme: [
                    { title: "Introduction à l'IA", content: "Histoire, définitions et état de l'art." },
                    { title: "Atelier Pratique", content: "Utilisation de ChatGPT et Midjourney." }
                ],
                sessions: [
                    { date: "2026-06-15", location: "Paris", places: 12 },
                    { date: "2026-09-20", location: "Distanciel", places: 20 }
                ]
            },
            {
                id: 2,
                title: "DEVELOPPEMENT NO CODE IA",
                category: "Informatique",
                duration: "3 jours",
                price: 2200,
                status: "Publié",
                image: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&w=800&q=80",
                mainTrainer: "101",
                description: "<p>Apprenez à construire des applications intelligentes sans écrire une seule ligne de code grâce aux outils modernes.</p>",
                tags: "NoCode, IA, Automatisation",
                prerequis: ["Culture web", "Compte OpenAI actif"],
                objectifs: ["Connecter des API", "Créer un chatbot personnalisé", "Automatiser des workflows"],
                programme: [
                    { title: "L'écosystème NoCode", content: "Make, Zapier, Bubble..." },
                    { title: "Création d'un agent", content: "Configuration et déploiement." }
                ],
                sessions: [
                    { date: "2026-07-05", location: "Lyon", places: 8 },
                    { date: "2026-10-12", location: "Distanciel", places: 15 }
                ]
            },
            {
                id: 3,
                title: "ISO 27001 IMPLEMENTATION",
                category: "Informatique",
                duration: "5 jours",
                price: 3500,
                status: "Publié",
                image: "https://images.unsplash.com/photo-1563986768609-322da13575f3?auto=format&fit=crop&w=800&q=80",
                mainTrainer: "102",
                description: "<p>Méthodologie complète pour implémenter un SMSI conforme à la norme ISO 27001.</p>",
                tags: "Cybersécurité, Norme, ISO",
                prerequis: ["Expérience en IT", "Notions de sécurité"],
                objectifs: ["Piloter un projet ISO 27001", "Gérer les risques", "Préparer l'audit"],
                programme: [
                    { title: "Le contexte normatif", content: "ISO 27001, 27002, GDPR..." },
                    { title: "Analyse de risques", content: "Méthode EBIOS et ISO 27005." }
                ],
                sessions: [
                    { date: "2026-10-01", location: "Paris", places: 10 },
                    { date: "2026-12-01", location: "Distanciel", places: 10 }
                ]
            }
        ];

        // -- CONSTANTS --
        // Initial defaults if storage is empty or reset
        const DEFAULT_CATEGORIES = ["Informatique", "Management", "Soft Skills", "Data", "Marketing"];

        const DEFAULT_LOCATIONS = [
            "Distanciel",
            "Paris",
            "Lyon",
            "Bordeaux",
            "Nantes",
            "Lille",
            "Toulouse",
            "Marseille"
        ];

        // -- MAIN APP COMPONENT --
        function App() {
            const [view, setView] = useState('list'); // 'list' | 'create' | 'categories' | 'trainers' | 'locations'
            const [filterCategory, setFilterCategory] = useState('Tout');
            const [editingCourse, setEditingCourse] = useState(null);

            // -- RESET LOGIC (Temporary for Test Set) --
            useEffect(() => {
                // Check if we need to seed the test data (using a version flag or just checking if trainers exist)
                // For this request, we force a reset if the specific test courses aren't there, or simply run once.
                // We'll use a session flag in sessionStorage to avoid infinite resets on reload if the user plays around.
                const hasSeeded = sessionStorage.getItem('seeded_v4');
                if (!hasSeeded) {
                    console.log("Seeding Test Data v4...");
                    localStorage.setItem('app_categories', JSON.stringify(DEFAULT_CATEGORIES));
                    localStorage.setItem('app_courses', JSON.stringify(INITIAL_COURSES));
                    localStorage.setItem('app_trainers', JSON.stringify(INITIAL_TRAINERS));
                    localStorage.setItem('app_locations', JSON.stringify(DEFAULT_LOCATIONS));

                    // Force state update by reloading from storage
                    setCategories(DEFAULT_CATEGORIES);
                    setCourses(INITIAL_COURSES);
                    setTrainers(INITIAL_TRAINERS);
                    setLocations(DEFAULT_LOCATIONS);

                    sessionStorage.setItem('seeded_v4', 'true');
                }
            }, []);

            // -- STATE: Categories --
            const [categories, setCategories] = useState(() => {
                const savedCats = localStorage.getItem('app_categories');
                return savedCats ? JSON.parse(savedCats) : DEFAULT_CATEGORIES;
            });

            // -- STATE: Courses --
            const [courses, setCourses] = useState(() => {
                const savedData = localStorage.getItem('app_courses');
                return savedData ? JSON.parse(savedData) : INITIAL_COURSES;
            });

            // -- STATE: Trainers --
            const [trainers, setTrainers] = useState(() => {
                const saved = localStorage.getItem('app_trainers');
                return saved ? JSON.parse(saved) : [];
            });

            // -- STATE: Locations --
            const [locations, setLocations] = useState(() => {
                const saved = localStorage.getItem('app_locations');
                return saved ? JSON.parse(saved) : DEFAULT_LOCATIONS;
            });

            // Persist Data
            useEffect(() => { localStorage.setItem('app_categories', JSON.stringify(categories)); window.dispatchEvent(new Event('storage')); }, [categories]);
            useEffect(() => { localStorage.setItem('app_courses', JSON.stringify(courses)); window.dispatchEvent(new Event('storage')); }, [courses]);
            useEffect(() => { localStorage.setItem('app_trainers', JSON.stringify(trainers)); }, [trainers]);
            useEffect(() => { localStorage.setItem('app_locations', JSON.stringify(locations)); }, [locations]);


            const deleteCourse = (id) => {
                if (confirm('Supprimer cette formation ?')) {
                    setCourses(courses.filter(c => c.id !== id));
                }
            };

            const handleDuplicate = (course) => {
                const newCourse = { ...course, id: Date.now(), title: course.title + ' (Copie)', status: 'Brouillon' };
                setCourses([...courses, newCourse]);
            };

            const handleDelete = (id) => deleteCourse(id);

            const handleToggleStatus = (id) => {
                setCourses(courses.map(c => c.id === id ? { ...c, status: c.status === 'Publié' ? 'Brouillon' : 'Publié' } : c));
            };

            const handleSave = (courseData) => {
                if (editingCourse) {
                    // Update existing
                    setCourses(courses.map(c => c.id === editingCourse.id ? { ...courseData, id: c.id, status: c.status } : c));
                    setEditingCourse(null);
                } else {
                    // Create new
                    setCourses([...courses, { ...courseData, id: Date.now(), status: "Brouillon" }]);
                }
                setView('list');
            };

            const handleEdit = (course) => {
                setEditingCourse(course);
                setView('create');
            };

            const handleCancelCreate = () => {
                setEditingCourse(null);
                setView('list');
            };

            const handleAddCategory = (newCat) => {
                if (!categories.includes(newCat)) setCategories([...categories, newCat]);
            };

            const handleDeleteCategory = (catToDelete) => {
                if (confirm(`Supprimer la catégorie "${catToDelete}" ?`)) setCategories(categories.filter(c => c !== catToDelete));
            };

            const handleEditCategory = (oldName, newName) => {
                if (categories.includes(newName)) { alert('Cette catégorie existe déjà !'); return; }
                // Update Categories List
                setCategories(categories.map(c => c === oldName ? newName : c));

                // Update all courses that used this category
                setCourses(courses.map(c => c.category === oldName ? { ...c, category: newName } : c));
            };

            const handleAddTrainer = (newTrainer) => setTrainers([...trainers, newTrainer]);
            const handleDeleteTrainer = (id) => { if (confirm('Supprimer ce formateur ?')) setTrainers(trainers.filter(t => t.id !== id)); };
            const handleEditTrainer = (updatedTrainer) => setTrainers(trainers.map(t => t.id === updatedTrainer.id ? updatedTrainer : t));

            // Locations handlers
            const handleAddLocation = (newLoc) => {
                if (!locations.includes(newLoc)) setLocations([...locations, newLoc]);
            };
            const handleDeleteLocation = (locToDelete) => {
                if (confirm(`Supprimer le lieu "${locToDelete}" ?`)) setLocations(locations.filter(l => l !== locToDelete));
            };
            const handleEditLocation = (oldName, newName) => {
                if (locations.includes(newName)) { alert('Ce lieu existe déjà !'); return; }
                setLocations(locations.map(l => l === oldName ? newName : l));
            };

            // Filter Courses Logic
            const filteredCourses = courses.filter(course => {
                return filterCategory === 'Tout' || course.category === filterCategory;
            });

            return (
                <div className="flex min-h-screen">
                    {/* Sidebar */}
                    <div className="w-64 bg-white border-r border-neutral-200 hidden md:flex flex-col">
                        <div className="p-6 border-b border-neutral-100">
                            <a href="index.html">
                                <h2 className="text-xl font-bold text-neutral-900 tracking-tight flex items-center gap-2">
                                    <div className="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center text-white">
                                        <Icons.Home />
                                    </div>
                                    Admin
                                </h2>
                            </a>
                        </div>
                        <nav className="flex-1 p-4 space-y-1">
                            <button onClick={() => { setView('list'); setEditingCourse(null); }} className={`w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg transition-colors ${view === 'list' ? 'bg-primary-50 text-primary-700' : 'text-neutral-600 hover:bg-neutral-50'}`}>
                                <Icons.Check /> Formations
                            </button>
                            <button onClick={() => { setView('categories'); setEditingCourse(null); }} className={`w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg transition-colors ${view === 'categories' ? 'bg-primary-50 text-primary-700' : 'text-neutral-600 hover:bg-neutral-50'}`}>
                                <Icons.Edit /> Catégories
                            </button>
                            <button onClick={() => { setView('trainers'); setEditingCourse(null); }} className={`w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg transition-colors ${view === 'trainers' ? 'bg-primary-50 text-primary-700' : 'text-neutral-600 hover:bg-neutral-50'}`}>
                                <Icons.Users /> Formateurs
                            </button>
                            <button onClick={() => { setView('locations'); setEditingCourse(null); }} className={`w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg transition-colors ${view === 'locations' ? 'bg-primary-50 text-primary-700' : 'text-neutral-600 hover:bg-neutral-50'}`}>
                                <Icons.MapPin /> Lieux
                            </button>
                            <a href="index.html" className="w-full flex items-center gap-3 px-4 py-2.5 text-sm font-medium rounded-lg text-neutral-600 hover:bg-neutral-50 transition-colors mt-8">
                                <Icons.ChevronLeft /> Voir le site
                            </a>
                        </nav>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col min-w-0 bg-neutral-50">
                        {/* Topbar */}
                        <header className="bg-white border-b border-neutral-200 px-8 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-6">
                                <h1 className="text-2xl font-bold text-neutral-800">
                                    {view === 'list' ? 'Gestion des Formations' : view === 'categories' ? 'Gestion des Catégories' : view === 'trainers' ? 'Gestion des Formateurs' : view === 'locations' ? 'Gestion des Lieux' : editingCourse ? 'Modifier la Formation' : 'Nouvelle Formation'}
                                </h1>
                                {view === 'list' && (
                                    <select
                                        value={filterCategory}
                                        onChange={(e) => setFilterCategory(e.target.value)}
                                        className="text-sm border-neutral-300 rounded-lg px-3 py-1.5 focus:ring-primary-500 focus:border-primary-500 bg-neutral-50 text-neutral-600 border"
                                    >
                                        <option value="Tout">Tout</option>
                                        {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                    </select>
                                )}
                            </div>

                            {view === 'list' && (
                                <button onClick={() => { setEditingCourse(null); setView('create'); }} className="flex items-center gap-2 px-4 py-2 bg-neutral-900 hover:bg-primary-600 text-white text-sm font-medium rounded-lg transition-all shadow-sm">
                                    <Icons.Plus /> Ajouter une formation
                                </button>
                            )}
                        </header>

                        <main className="flex-1 p-8 overflow-y-auto">
                            {view === 'list' ? (
                                <CourseList courses={filteredCourses} onDelete={handleDelete} onDuplicate={handleDuplicate} onToggleStatus={handleToggleStatus} onEdit={handleEdit} />
                            ) : view === 'create' ? (
                                <CreateCourseForm
                                    key={editingCourse ? editingCourse.id : 'create-new'}
                                    onCancel={handleCancelCreate}
                                    onSubmit={handleSave}
                                    categories={categories}
                                    initialData={editingCourse}
                                    trainers={trainers}
                                    locations={locations}
                                />
                            ) : view === 'categories' ? (
                                <CategoriesManager categories={categories} onAdd={handleAddCategory} onDelete={handleDeleteCategory} onEdit={handleEditCategory} />
                            ) : view === 'locations' ? (
                                <CategoriesManager categories={locations} onAdd={handleAddLocation} onDelete={handleDeleteLocation} onEdit={handleEditLocation} title="des Lieux" itemName="ce lieu" />
                            ) : (
                                <TrainersManager trainers={trainers} onAdd={handleAddTrainer} onDelete={handleDeleteTrainer} onEdit={handleEditTrainer} categories={categories} />
                            )}
                        </main>
                    </div>
                </div>
            );
        }

        // -- VIEW: COURSE LIST --
        function CourseList({ courses, onDelete, onDuplicate, onToggleStatus, onEdit }) {
            return (
                <div className="bg-white rounded-xl shadow-sm border border-neutral-200 overflow-hidden slide-in">
                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-neutral-200">
                            <thead className="bg-neutral-50">
                                <tr>
                                    <th className="px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider">Formation</th>
                                    <th className="px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider">Catégorie</th>
                                    <th className="px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider">Prix</th>
                                    <th className="px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider">Statut</th>
                                    <th className="px-6 py-4 text-right text-xs font-semibold text-neutral-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-neutral-200">
                                {courses.map((course) => (
                                    <tr key={course.id} className="hover:bg-neutral-50 transition-colors">
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <div className="flex items-center">
                                                <div className="h-10 w-10 flex-shrink-0 bg-neutral-100 rounded-lg flex items-center justify-center text-neutral-500 font-bold text-xs">IMG</div>
                                                <div className="ml-4">
                                                    <div className="text-sm font-medium text-neutral-900">{course.title}</div>
                                                    <div className="text-xs text-neutral-500">{course.duration}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className="px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-primary-50 text-primary-700">
                                                {course.category}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-neutral-600">
                                            {course.price} €
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <button
                                                onClick={() => onToggleStatus(course.id)}
                                                className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium cursor-pointer hover:opacity-80 transition-opacity ${course.status === 'Publié' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}
                                                title="Cliquer pour changer le statut"
                                            >
                                                {course.status}
                                            </button>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <div className="flex items-center justify-end gap-3">
                                                <button onClick={() => window.open(`detail.html?id=${course.id}`, '_blank')} className="text-neutral-400 hover:text-blue-500 transition-colors" title="Voir la formation">
                                                    <Icons.Eye />
                                                </button>
                                                <button onClick={() => onEdit(course)} className="text-neutral-400 hover:text-primary-600 transition-colors" title="Modifier">
                                                    <Icons.Edit />
                                                </button>
                                                <button onClick={() => onDuplicate(course)} className="text-neutral-400 hover:text-primary-600 transition-colors" title="Dupliquer">
                                                    <Icons.Copy />
                                                </button>
                                                <button onClick={() => onDelete(course.id)} className="text-neutral-400 hover:text-red-600 transition-colors" title="Supprimer">
                                                    <Icons.Trash />
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // -- COMPONENT: RICH TEXT EDITOR (Quill Wrapper) --
        function RichTextEditor({ value, onChange, placeholder, style }) {
            const editorRef = React.useRef(null);
            const quillRef = React.useRef(null);

            React.useEffect(() => {
                if (editorRef.current && !quillRef.current) {
                    quillRef.current = new Quill(editorRef.current, {
                        theme: 'snow',
                        placeholder: placeholder || 'Rédigez ici...',
                        modules: {
                            toolbar: [
                                ['bold', 'italic', 'underline'],
                                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                                ['clean']
                            ]
                        }
                    });

                    quillRef.current.on('text-change', () => {
                        onChange(quillRef.current.root.innerHTML);
                    });
                }
            }, []);

            React.useEffect(() => {
                if (quillRef.current && value !== quillRef.current.root.innerHTML) {
                    // Only update if content is different to avoid cursor jumps
                    // Note: This is a simplified check, adequate for this context
                    // quillRef.current.root.innerHTML = value || ''; 
                }
            }, [value]);

            return <div ref={editorRef} style={{ height: '150px', ...style }} className="bg-white"></div>;
        }

        // -- VIEW: CATEGORIES / LOCATIONS MANAGER --
        function CategoriesManager({ categories, onAdd, onDelete, onEdit, title = "des Catégories", itemName = "cette catégorie" }) {
            const [newCat, setNewCat] = useState('');
            const [editingCat, setEditingCat] = useState(null);
            const [editValue, setEditValue] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (newCat.trim()) {
                    onAdd(newCat.trim());
                    setNewCat('');
                }
            };

            const startEdit = (cat) => {
                setEditingCat(cat);
                setEditValue(cat);
            };

            const saveEdit = () => {
                if (editValue.trim() && editValue !== editingCat) {
                    onEdit(editingCat, editValue.trim());
                }
                setEditingCat(null);
                setEditValue('');
            };

            const cancelEdit = () => {
                setEditingCat(null);
                setEditValue('');
            };

            return (
                <div className="max-w-2xl mx-auto space-y-8 slide-in">
                    {/* Add Item */}
                    <div className="bg-white rounded-xl shadow-sm border border-neutral-200 p-6">
                        <h3 className="text-lg font-bold text-neutral-900 mb-4">Ajouter : {title}</h3>
                        <form onSubmit={handleSubmit} className="flex gap-4">
                            <input
                                type="text"
                                value={newCat}
                                onChange={(e) => setNewCat(e.target.value)}
                                placeholder="Nom..."
                                className="flex-1 px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none"
                            />
                            <button type="submit" disabled={!newCat.trim()} className="px-6 py-2 bg-primary-600 text-white font-bold rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                Ajouter
                            </button>
                        </form>
                    </div>

                    {/* List Items */}
                    <div className="bg-white rounded-xl shadow-sm border border-neutral-200 overflow-hidden">
                        <div className="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
                            <h3 className="text-lg font-bold text-neutral-900">Liste {title} ({categories.length})</h3>
                        </div>
                        <ul className="divide-y divide-neutral-200">
                            {categories.map((cat) => (
                                <li key={cat} className="px-6 py-4 flex items-center justify-between hover:bg-neutral-50 transition-colors group">
                                    {editingCat === cat ? (
                                        <div className="flex-1 flex gap-2">
                                            <input
                                                type="text"
                                                value={editValue}
                                                onChange={(e) => setEditValue(e.target.value)}
                                                className="flex-1 px-3 py-1 border border-primary-300 rounded-lg outline-none focus:ring-2 focus:ring-primary-200"
                                                autoFocus
                                            />
                                            <button onClick={saveEdit} className="text-green-600 hover:text-green-800 font-medium text-sm px-3 py-1">Enregistrer</button>
                                            <button onClick={cancelEdit} className="text-neutral-400 hover:text-neutral-600 text-sm px-2">Annuler</button>
                                        </div>
                                    ) : (
                                        <>
                                            <span className="font-medium text-neutral-700">{cat}</span>
                                            <div className="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-all">
                                                <button
                                                    onClick={() => startEdit(cat)}
                                                    className="text-neutral-400 hover:text-primary-600 p-2 bg-white rounded-lg shadow-sm border border-neutral-200"
                                                    title="Renommer"
                                                >
                                                    <Icons.Edit />
                                                </button>
                                                <button
                                                    onClick={() => onDelete(cat)}
                                                    className="text-neutral-400 hover:text-red-500 p-2 bg-white rounded-lg shadow-sm border border-neutral-200"
                                                    title={`Supprimer ${itemName}`}
                                                >
                                                    <Icons.Trash />
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>
            );
        }

        // -- VIEW: CREATE COURSE FORM (Advanced) --
        function CreateCourseForm({ onCancel, onSubmit, categories, initialData, trainers, locations }) {
            const [step, setStep] = useState(0);
            const [formData, setFormData] = useState(() => {
                const defaultData = {
                    title: '',
                    category: 'Informatique',
                    duration: '',
                    price: '',
                    image: '',
                    description: '',
                    tags: '',
                    prerequis: [''],
                    objectifs: [''],
                    programme: [{ title: '', content: '' }],
                    sessions: [{ date: '', location: 'Distanciel', places: 10 }],
                    mainTrainer: '',
                    substituteTrainer: ''
                };

                if (!initialData) return defaultData;

                return {
                    ...defaultData,
                    ...initialData
                };
            });
            const [errors, setErrors] = useState({});

            const STEPS = [
                { id: 0, title: "Infos & Détails", desc: "Présentation" },
                { id: 1, title: "Pédagogie", desc: "Objectifs & Prérequis" },
                { id: 2, title: "Programme", desc: "Contenu détaillé" },
                { id: 3, title: "Planification", desc: "Sessions" }
            ];

            const validateStep = (currentStep) => {
                let newErrors = {};
                if (currentStep === 0) {
                    if (!formData.title || formData.title.trim() === '') newErrors.title = "Le titre est requis";
                    if (!formData.price || formData.price === '') newErrors.price = "Le prix est requis";
                }
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleNext = () => {
                if (validateStep(step)) setStep(prev => prev + 1);
            };

            const toggleTrainer = (tid) => {
                const current = formData.assignedTrainers || [];
                // Use robust comparison (String) to handle potential type mismatches
                const exists = current.some(id => String(id) === String(tid));

                if (exists) {
                    setFormData({ ...formData, assignedTrainers: current.filter(id => String(id) !== String(tid)) });
                } else {
                    setFormData({ ...formData, assignedTrainers: [...current, tid] });
                }
            };

            // Dynamic List Helper
            const updateListItem = (field, index, value) => {
                const list = [...formData[field]];
                list[index] = value;
                setFormData({ ...formData, [field]: list });
            };
            const addListItem = (field) => setFormData({ ...formData, [field]: [...formData[field], ''] });
            const removeListItem = (field, index) => setFormData({ ...formData, [field]: formData[field].filter((_, i) => i !== index) });

            // Dynamic Modules Helper
            const updateModule = (index, field, value) => {
                const newModules = [...formData.programme];
                newModules[index][field] = value;
                setFormData({ ...formData, programme: newModules });
            };
            const addModule = () => setFormData({ ...formData, programme: [...formData.programme, { title: '', content: '' }] });
            const removeModule = (index) => setFormData({ ...formData, programme: formData.programme.filter((_, i) => i !== index) });

            // Dynamic Sessions Helper
            const updateSession = (index, field, value) => {
                const newSessions = [...formData.sessions];
                newSessions[index][field] = value;
                setFormData({ ...formData, sessions: newSessions });
            };
            const addSession = () => setFormData({ ...formData, sessions: [...formData.sessions, { date: '', location: 'Distanciel', places: 10 }] });
            const removeSession = (index) => setFormData({ ...formData, sessions: formData.sessions.filter((_, i) => i !== index) });

            return (
                <div className="bg-white rounded-xl shadow-lg border border-neutral-200 max-w-5xl mx-auto flex flex-col overflow-hidden slide-in h-[85vh]">

                    {/* Stepper Header */}
                    <div className="bg-neutral-50 px-6 py-4 border-b border-neutral-200 shrink-0">
                        <div className="flex items-center justify-between overflow-x-auto gap-4">
                            {STEPS.map((s, i) => (
                                <div key={s.id} className="flex items-center gap-2 relative z-10 whitespace-nowrap">
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs border-2 transition-colors ${step >= s.id ? 'bg-primary-600 border-primary-600 text-white' : 'bg-white border-neutral-300 text-neutral-400'}`}>
                                        {step > s.id ? <Icons.Check /> : i + 1}
                                    </div>
                                    <div className={`${step >= s.id ? 'text-primary-900' : 'text-neutral-400'}`}>
                                        <p className="text-sm font-bold">{s.title}</p>
                                    </div>
                                    {i !== STEPS.length - 1 && <div className="hidden md:block w-12 h-0.5 bg-neutral-200 mx-2" />}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Scrollable Content */}
                    <div className="flex-1 overflow-y-auto p-8 bg-neutral-50/50">

                        {/* STEP 0: INFOS GENERALES */}
                        {step === 0 && (
                            <div className="space-y-6 max-w-3xl mx-auto anime-enter">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="col-span-2">
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Titre de la formation *</label>
                                        <input type="text" value={formData.title} onChange={e => setFormData({ ...formData, title: e.target.value })} className="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none" placeholder="Ex: Masterclass UX Design" />
                                        {errors.title && <p className="text-red-500 text-xs mt-1">{errors.title}</p>}
                                    </div>

                                    <div>
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Catégorie</label>
                                        <select value={formData.category} onChange={e => setFormData({ ...formData, category: e.target.value })} className="w-full px-4 py-2 border border-neutral-300 rounded-lg outline-none">
                                            {(categories || ["Management"]).map(c => <option key={c}>{c}</option>)}
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Tags (séparés par des virgules)</label>
                                        <input type="text" value={formData.tags} onChange={e => setFormData({ ...formData, tags: e.target.value })} className="w-full px-4 py-2 border border-neutral-300 rounded-lg outline-none" placeholder="ex: CPF, Certifiant, Top Vente" />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Prix (€) *</label>
                                        <input type="number" value={formData.price} onChange={e => setFormData({ ...formData, price: e.target.value })} className="w-full px-4 py-2 border border-neutral-300 rounded-lg outline-none" />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Durée (ex: 2 jours)</label>
                                        <input type="text" value={formData.duration} onChange={e => setFormData({ ...formData, duration: e.target.value })} className="w-full px-4 py-2 border border-neutral-300 rounded-lg outline-none" />
                                    </div>

                                    <div className="col-span-2">
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">URL de l'image (optionnel)</label>
                                        <input type="text" value={formData.image} onChange={e => setFormData({ ...formData, image: e.target.value })} className="w-full px-4 py-2 border border-neutral-300 rounded-lg outline-none" placeholder="https://..." />
                                    </div>



                                    <div className="col-span-1">
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Formateur Principal</label>
                                        <select
                                            value={formData.mainTrainer || ''}
                                            onChange={e => setFormData({ ...formData, mainTrainer: e.target.value })}
                                            className="w-full px-4 py-2 border border-neutral-300 rounded-lg outline-none bg-white"
                                        >
                                            <option value="">-- Sélectionner --</option>
                                            {(trainers || []).filter(t => t && t.id).map(t => (
                                                <option key={t.id} value={t.id}>{t.firstName} {t.lastName}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="col-span-1">
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Formateur Suppléant (Optionnel)</label>
                                        <select
                                            value={formData.substituteTrainer || ''}
                                            onChange={e => setFormData({ ...formData, substituteTrainer: e.target.value })}
                                            className="w-full px-4 py-2 border border-neutral-300 rounded-lg outline-none bg-white"
                                        >
                                            <option value="">-- Aucun --</option>
                                            {(trainers || []).filter(t => t && t.id && String(t.id) !== String(formData.mainTrainer)).map(t => (
                                                <option key={t.id} value={t.id}>{t.firstName} {t.lastName}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="col-span-2">
                                        <label className="block text-sm font-bold text-neutral-700 mb-1">Description courte (HTML)</label>
                                        <RichTextEditor value={formData.description} onChange={(val) => setFormData({ ...formData, description: val })} />
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* STEP 1: PEDAGOGIE (PREREQUIS & OBJECTIFS) */}
                        {step === 1 && (
                            <div className="space-y-8 max-w-3xl mx-auto anime-enter">
                                {/* Objectifs */}
                                <div>
                                    <div className="flex items-center justify-between mb-2">
                                        <label className="block text-sm font-bold text-neutral-700">Objectifs pédagogiques</label>
                                        <button onClick={() => addListItem('objectifs')} className="text-xs font-bold text-primary-600 hover:text-primary-800 flex items-center gap-1">+ Ajouter</button>
                                    </div>
                                    <div className="space-y-2">
                                        {formData.objectifs.map((obj, i) => (
                                            <div key={i} className="flex gap-2">
                                                <input type="text" value={obj} onChange={e => updateListItem('objectifs', i, e.target.value)} className="flex-1 px-3 py-2 border border-neutral-300 rounded-lg text-sm" placeholder="Objectif..." />
                                                <button onClick={() => removeListItem('objectifs', i)} className="text-neutral-400 hover:text-red-500"><Icons.Trash /></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Prérequis */}
                                <div>
                                    <div className="flex items-center justify-between mb-2">
                                        <label className="block text-sm font-bold text-neutral-700">Prérequis</label>
                                        <button onClick={() => addListItem('prerequis')} className="text-xs font-bold text-primary-600 hover:text-primary-800 flex items-center gap-1">+ Ajouter</button>
                                    </div>
                                    <div className="space-y-2">
                                        {formData.prerequis.map((req, i) => (
                                            <div key={i} className="flex gap-2">
                                                <input type="text" value={req} onChange={e => updateListItem('prerequis', i, e.target.value)} className="flex-1 px-3 py-2 border border-neutral-300 rounded-lg text-sm" placeholder="Prérequis..." />
                                                <button onClick={() => removeListItem('prerequis', i)} className="text-neutral-400 hover:text-red-500"><Icons.Trash /></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* STEP 2: PROGRAMME (MODULES RICHES) */}
                        {step === 2 && (
                            <div className="space-y-6 max-w-4xl mx-auto anime-enter">
                                <p className="text-sm text-neutral-500 mb-4">Créez le déroulé de la formation par journée ou par grand module.</p>

                                {formData.programme.map((mod, i) => (
                                    <div key={i} className="bg-white border border-neutral-200 rounded-xl p-6 shadow-sm relative group">
                                        <button onClick={() => removeModule(i)} className="absolute top-4 right-4 text-neutral-300 hover:text-red-500 transition-colors"><Icons.Trash /></button>

                                        <div className="mb-4">
                                            <label className="block text-xs font-bold text-neutral-500 uppercase tracking-wide mb-1">Titre du module / Jour {i + 1}</label>
                                            <input
                                                type="text"
                                                value={mod.title}
                                                onChange={e => updateModule(i, 'title', e.target.value)}
                                                className="w-full text-lg font-bold border-b border-neutral-200 focus:border-primary-500 outline-none py-1 text-neutral-900 placeholder-neutral-300"
                                                placeholder="Ex: Les fondamentaux..."
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-bold text-neutral-500 mb-1">Contenu détaillé (Rich Text)</label>
                                            <RichTextEditor
                                                value={mod.content}
                                                onChange={val => updateModule(i, 'content', val)}
                                                style={{ height: '200px' }}
                                                placeholder="Détaillez les points abordés..."
                                            />
                                        </div>
                                    </div>
                                ))}

                                <button onClick={addModule} className="w-full py-4 border-2 border-dashed border-neutral-300 rounded-xl text-neutral-500 hover:border-primary-500 hover:text-primary-600 font-bold transition-all flex items-center justify-center gap-2">
                                    <Icons.Plus /> Ajouter un module
                                </button>
                            </div>
                        )}

                        {/* STEP 3: PLANIFICATION */}
                        {step === 3 && (
                            <div className="space-y-4 max-w-4xl mx-auto anime-enter">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr>
                                            <th className="p-2 text-xs font-bold text-neutral-500 uppercase">Date</th>
                                            <th className="p-2 text-xs font-bold text-neutral-500 uppercase">Lieu</th>
                                            <th className="p-2 text-xs font-bold text-neutral-500 uppercase">Places</th>
                                            <th className="p-2"></th>
                                        </tr>
                                    </thead>
                                    <tbody className="space-y-2">
                                        {formData.sessions.map((sess, i) => (
                                            <tr key={i} className="bg-white border-b border-neutral-100">
                                                <td className="p-2">
                                                    <input type="date" value={sess.date} onChange={e => updateSession(i, 'date', e.target.value)} className="w-full px-2 py-1 border border-neutral-200 rounded text-sm" />
                                                </td>
                                                <td className="p-2">
                                                    <select value={sess.location} onChange={e => updateSession(i, 'location', e.target.value)} className="w-full px-2 py-1 border border-neutral-200 rounded text-sm">
                                                        {(locations || ["Distanciel"]).map(loc => <option key={loc} value={loc}>{loc}</option>)}
                                                    </select>
                                                </td>
                                                <td className="p-2">
                                                    <input type="number" value={sess.places} onChange={e => updateSession(i, 'places', e.target.value)} className="w-20 px-2 py-1 border border-neutral-200 rounded text-sm" />
                                                </td>
                                                <td className="p-2 text-right">
                                                    <button onClick={() => removeSession(i)} className="text-neutral-400 hover:text-red-500"><Icons.Trash /></button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                                <button onClick={addSession} className="text-sm font-bold text-primary-600 hover:text-primary-800 flex items-center gap-1 mt-2">
                                    <Icons.Plus /> Ajouter une date
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Footer Actions */}
                    <div className="bg-neutral-50 px-8 py-4 border-t border-neutral-200 flex justify-between items-center shrink-0">
                        {step > 0 ? (
                            <button onClick={() => setStep(step - 1)} className="px-6 py-2.5 bg-white border border-neutral-300 text-neutral-700 font-medium rounded-lg hover:bg-neutral-50 transition-colors">Précédent</button>
                        ) : (
                            <button onClick={onCancel} className="px-6 py-2.5 bg-white border border-neutral-300 text-neutral-700 font-medium rounded-lg hover:bg-neutral-50 transition-colors">Annuler</button>
                        )}

                        {step < 3 ? (
                            <button onClick={handleNext} className="px-6 py-2.5 bg-neutral-900 text-white font-medium rounded-lg hover:bg-neutral-800 transition-colors flex items-center gap-2">Suivant <Icons.ChevronRight /></button>
                        ) : (
                            <button onClick={() => onSubmit(formData)} className="px-8 py-2.5 bg-primary-600 text-white font-bold rounded-lg hover:bg-primary-700 shadow-md transform hover:scale-105 transition-all">Publier la formation</button>
                        )}
                    </div>
                </div>
            );
        }

        // -- VIEW: TRAINERS MANAGER --
        function TrainersManager({ trainers, onAdd, onDelete, onEdit, categories }) {
            const [isEditing, setIsEditing] = useState(false);
            const [editId, setEditId] = useState(null);

            const [formData, setFormData] = useState({
                firstName: '', lastName: '', phone: '', email: '',
                address: '', city: '', zip: '',
                company: '', siret: '', tva: '',
                domains: [] // Array of strings
            });

            const [domainInput, setDomainInput] = useState('');

            // Search & Sorting State
            const [searchTerm, setSearchTerm] = useState('');
            const [sortBy, setSortBy] = useState('nameAsc');

            // Derived State: Filtered & Sorted Logic
            const filteredTrainers = (trainers || []).filter(t => {
                const s = searchTerm.toLowerCase();
                const match = (val) => (val || '').toLowerCase().includes(s);
                return match(t.firstName) || match(t.lastName) || match(t.company) || match(t.email) || match(t.city);
            }).sort((a, b) => {
                switch (sortBy) {
                    case 'nameAsc': return (a.lastName || '').localeCompare(b.lastName || '');
                    case 'nameDesc': return (b.lastName || '').localeCompare(a.lastName || '');
                    case 'company': return (a.company || '').localeCompare(b.company || '');
                    default: return 0;
                }
            });

            // Reset form when opening/closing
            const resetForm = () => {
                setFormData({
                    firstName: '', lastName: '', phone: '', email: '',
                    address: '', city: '', zip: '',
                    company: '', siret: '', tva: '',
                    domains: []
                });
                setDomainInput('');
                setIsEditing(false);
                setEditId(null);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (isEditing) {
                    onEdit({ ...formData, id: editId });
                } else {
                    onAdd({ ...formData, id: Date.now() });
                }
                resetForm();
            };

            const handleEditClick = (trainer) => {
                setFormData(trainer);
                setEditId(trainer.id);
                setIsEditing(true);
            };

            const addDomain = (e) => {
                e.preventDefault();
                if (domainInput.trim() && !formData.domains.includes(domainInput.trim())) {
                    setFormData({ ...formData, domains: [...formData.domains, domainInput.trim()] });
                    setDomainInput('');
                }
            };

            const removeDomain = (dom) => {
                setFormData({ ...formData, domains: formData.domains.filter(d => d !== dom) });
            };

            return (
                <div className="flex flex-col lg:flex-row gap-8 h-full">
                    {/* List Column */}
                    {/* List Column */}
                    <div className="flex-1 overflow-y-auto pr-2">
                        {/* Filter Controls */}
                        <div className="bg-white p-4 mb-4 rounded-xl border border-neutral-200 shadow-sm sticky top-0 z-10 flex flex-col sm:flex-row gap-4 items-center justify-between">
                            <div className="relative w-full sm:flex-1">
                                <span className="absolute left-3 top-2.5 text-neutral-400">
                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                                </span>
                                <input
                                    type="text"
                                    placeholder="Rechercher (nom, ville, société...)"
                                    className="w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-primary-500 transition-all"
                                    value={searchTerm}
                                    onChange={e => setSearchTerm(e.target.value)}
                                />
                            </div>
                            <select
                                value={sortBy}
                                onChange={e => setSortBy(e.target.value)}
                                className="w-full sm:w-auto border border-neutral-200 rounded-lg text-sm px-4 py-2 outline-none focus:ring-2 focus:ring-primary-500 bg-white cursor-pointer font-medium text-neutral-700"
                            >
                                <option value="nameAsc">Nom (A-Z)</option>
                                <option value="nameDesc">Nom (Z-A)</option>
                                <option value="company">Société</option>
                            </select>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {filteredTrainers.length === 0 && (
                                <div className="col-span-full text-center py-10 bg-neutral-50 rounded-xl border border-dashed border-neutral-300 text-neutral-500 italic">
                                    Aucun formateur trouvé pour "{searchTerm}"
                                </div>
                            )}
                            {filteredTrainers.map(trainer => (
                                <div key={trainer.id} className="bg-white p-5 rounded-xl border border-neutral-200 shadow-sm hover:shadow-md transition-shadow relative group">
                                    <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button onClick={() => handleEditClick(trainer)} className="text-neutral-400 hover:text-primary-600 p-1"><Icons.Edit /></button>
                                        <button onClick={() => onDelete(trainer.id)} className="text-neutral-400 hover:text-red-500 p-1"><Icons.Trash /></button>
                                    </div>

                                    <div className="flex items-center gap-3 mb-3">
                                        <div className="w-10 h-10 rounded-full bg-primary-100 text-primary-700 flex items-center justify-center font-bold text-lg">
                                            {(trainer.firstName || '?')[0]}{(trainer.lastName || '?')[0]}
                                        </div>
                                        <div>
                                            <h3 className="font-bold text-neutral-900">{trainer.firstName || 'Sans nom'} {trainer.lastName || ''}</h3>
                                            <p className="text-xs text-neutral-500">{trainer.company || "Indépendant"}</p>
                                        </div>
                                    </div>

                                    <div className="space-y-1 text-sm text-neutral-600 mb-4">
                                        <div className="flex items-center gap-2"><Icons.MapPin /> {trainer.city || 'N/A'}</div>
                                        <div className="flex items-center gap-2"><Icons.Phone /> {trainer.phone || 'N/A'}</div>
                                    </div>

                                    <div className="flex flex-wrap gap-1">
                                        {(trainer.domains || []).map(cat => (
                                            <span key={cat} className="px-2 py-0.5 bg-neutral-100 text-neutral-600 text-xs rounded-md border border-neutral-200">{cat}</span>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Form Column */}
                    <div className="w-full lg:w-96 shrink-0">
                        <div className="bg-white rounded-xl shadow-lg border border-neutral-100 p-6 sticky top-0">
                            <h3 className="font-bold text-lg text-neutral-900 mb-4">{isEditing ? 'Modifier le formateur' : 'Nouveau formateur'}</h3>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid grid-cols-2 gap-3">
                                    <input required type="text" placeholder="Prénom" value={formData.firstName} onChange={e => setFormData({ ...formData, firstName: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                    <input required type="text" placeholder="Nom" value={formData.lastName} onChange={e => setFormData({ ...formData, lastName: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    <input type="tel" placeholder="Téléphone" value={formData.phone} onChange={e => setFormData({ ...formData, phone: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                    <input type="email" placeholder="Email" value={formData.email} onChange={e => setFormData({ ...formData, email: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                </div>
                                <input type="text" placeholder="Adresse" value={formData.address} onChange={e => setFormData({ ...formData, address: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                <div className="grid grid-cols-2 gap-3">
                                    <input type="text" placeholder="Code Postal" value={formData.zip} onChange={e => setFormData({ ...formData, zip: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                    <input type="text" placeholder="Ville" value={formData.city} onChange={e => setFormData({ ...formData, city: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                </div>
                                <hr className="border-neutral-100" />
                                <input type="text" placeholder="Société" value={formData.company} onChange={e => setFormData({ ...formData, company: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                <div className="grid grid-cols-2 gap-3">
                                    <input type="text" placeholder="SIRET" value={formData.siret} onChange={e => setFormData({ ...formData, siret: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                    <input type="text" placeholder="N° TVA" value={formData.tva} onChange={e => setFormData({ ...formData, tva: e.target.value })} className="w-full px-3 py-2 border rounded-lg text-sm" />
                                </div>

                                <div>
                                    <label className="block text-xs font-bold text-neutral-500 mb-1">Domaines d'intervention</label>
                                    <div className="flex gap-2 mb-2">
                                        <select
                                            value={domainInput}
                                            onChange={e => setDomainInput(e.target.value)}
                                            className="flex-1 px-3 py-2 border rounded-lg text-sm bg-white outline-none focus:ring-2 focus:ring-primary-500"
                                        >
                                            <option value="">Choisir une catégorie...</option>
                                            {(categories || []).map(cat => (
                                                <option key={cat} value={cat}>{cat}</option>
                                            ))}
                                        </select>
                                        <button
                                            type="button"
                                            onClick={addDomain}
                                            disabled={!domainInput}
                                            className="px-4 py-2 bg-neutral-100 hover:bg-neutral-200 rounded-lg text-sm font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                        >
                                            +
                                        </button>
                                    </div>
                                    <p className="text-[10px] text-neutral-400 mb-2 italic">
                                        * Les domaines sont basés sur les catégories existantes.
                                    </p>
                                    <div className="flex flex-wrap gap-1">
                                        {formData.domains.map(d => (
                                            <span key={d} className="inline-flex items-center gap-1 px-2 py-1 bg-primary-50 text-primary-700 text-xs rounded-md">
                                                {d} <button type="button" onClick={() => removeDomain(d)} className="hover:text-red-500">×</button>
                                            </span>
                                        ))}
                                    </div>
                                </div>

                                <div className="flex gap-2 pt-2">
                                    {isEditing && <button type="button" onClick={resetForm} className="flex-1 py-2 bg-neutral-100 text-neutral-600 text-sm font-bold rounded-lg hover:bg-neutral-200">Annuler</button>}
                                    <button type="submit" className="flex-1 py-2 bg-neutral-900 text-white text-sm font-bold rounded-lg hover:bg-neutral-800">{isEditing ? 'Enregistrer' : 'Créer le formateur'}</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>